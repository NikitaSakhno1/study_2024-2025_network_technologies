РОССИЙСКИЙ УНИВЕРСИТЕТ ДРУЖБЫ НАРОДОВ

**Факультет физико-математических и естественных наук**

**Кафедра прикладной информатики и теории вероятностей**

ОТЧЕТ

по лабораторной работе №7

дисциплина: Сетевые технологии

Студент: Сахно Никита

Группа: НФИбд-02-23

**МОСКВА**

2025 г.

**Цель:**

Получить навыки настройки службы DHCP на сетевом оборудовании для распределения адресов IPv4 и IPv6.

**Задания:**

1.  Настройка DHCP в случае IPv4
2.  Настройка DHCP в случае IPv6

**Выполнение лабораторной работы:**

**№1**

После запуска GNS3 VM и GNS3 и создания проекта в рабочем пространстве разместим и соединим устройства в соответствии с данной нам топологией. Используем маршрутизатор VyOS и хост VPCS. Изменим отображаемые названия устройств в соответствии с требованиями. Включим захват трафика между коммутатором и маршрутизатором.

Рисунок 1. Топология моделируемой сети

Далее перейдем к настройке образа VyOS. Перейдем в режим конфигурирования, изменим имя устройства и доменное имя, заменим системного пользователя, заданного по умолчанию, на моего пользователя.

Зайдем в систему под своим пользователем, который задали.

На маршрутизаторе под созданным пользователем перейдем в режим конфигурирования и настроем адресацию IPv4, а также добавим конфигурацию DHCP-сервера на маршрутизаторе:

Рисунок 1. Настройка адресации IPv4 и добавление конфигурации DHCP-сервера

Таким образом, при помощи указанных выше команд была создана разделяемая сеть (shared-network-name) с названием nvsakhno, подсеть (subnet) с адресом 10.0.0.0/24, задан диапазон адресов (range) с именем hosts, содержащий адреса 10.0.0.2–10.0.0.253.

Далее просмотрим статистику DHCP-сервера и выданных адресов:

Рисунок 2. Просмотр статистики DHCP-сервера и выданных данных

Перейдем к настройке оконечного устройства (PC1):

Рисунок 3. Настройка PC1

Проверим конфигурацию на узле и пропингуем маршрутизатор:

Рисунок 3. Результат настройки PC1

На маршрутизаторе вновь посмотри статистику DHCP-сервера и выданные адреса:

Рисунок 9. Просмотр статистики DHCP-сервера и выданных адресов

Анализ статистики: видно, что в столбце Leases значение изменилось с 0 до 1, поскольку один сетевой адрес выдан на время PC1. Соответственно в столбце Available число доступных сетевых адресов уменьшилось на 1.

Анализ выданных адресов: видно, что выдан адрес 10.0.0.2 (первый из заданного нами диапазона IP-адресов для подсети 10.0.0.0.24), также указан физический адрес, а также время аренды (адрес выдан на день).

Далее просмотрим журнал работы DHCP-сервера:

Рисунок 10. Журнал работы DHCP-сервера

Посмотрим захваченную анализатором трафика пакеты, относящиеся к работе DHCP и назначению адреса устройства:

Рисунок 11. Захваченные пакеты в Wireshark

В процессе получения устройством адреса по протоколу DHCP сначала идет сообщение «DHCP DISCOVER»: устройство отправляет широковещательный запрос, в котором во фрейме (PDU канального уровня) в поле адреса отправителя указывается MAC-адрес устройства, а в поле адреса получателя — широковещательный адрес ffff.ffff.ffff; в пакете (PDU сетевого уровня) в поле адреса отправителя указан адрес 0.0.0.0, а в поле адреса получателя — адрес 255.255.255.255;

– сообщение «DHCP OFFER»: DHCP-сервер после получения широковещательного сообщения выделяет (но не резервирует) в своём пуле адресов некоторый адрес DHCP-клиенту на заданное время (lease time), назначает другие настройки (опции) и пересылает всю информацию DHCP-клиенту; при этом в соответствующих полях получателя в сообщении указываются выделенный клиенту IP-адрес и его MAC-адрес (тут видим, что адрес отправителя – 10.0.0.1 – адрес DHCP-сервера, а адрес получателя 10.0.0.2 – адрес, предлагаемый клиенту);

– сообщение «DHCP REQUEST»: клиент отправляет DHCP-серверу согласие с полученными параметрами;

– сообщение «DHCP ACKNOWLEDGE»: DHCP-сервер резервирует за DHCP-клиентом выделенный адрес на какое-то время (lease time), вносит информацию в свою ARP-таблицу и высылает DHCP-клиенту сообщение об успешной регистрации адреса.

**№2**

В предыдущем проекте в рабочем пространстве дополним сеть, разместив и соединив устройства в соответствии с топологией, приведённой в примере. Используем хост (клиент) Kali Linux (добавим образ Kali Linux версии 2019.3 в перечень устройств в GNS3), поскольку клиент VPCS не поддерживает DHCPv6. Изменим отображаемые названия устройств, выполняя соглашение об именовании. Включим захват трафика на соединениях между маршрутизатором gw-01 и коммутаторами sw-02 и sw-03.

Настроим адресацию IPv6 на маршрутизаторе:

Рисунок 13. Настройка адресации IPv6 на маршрутизаторе

На маршрутизаторе настроим DHCPv6 без отслеживания состояния (DHCPv6 Stateless configuration).

Для начала настроим объявления о маршрутизаторах (Router Advertisements, RA) на интерфейсе eth1. Опция other-config-flag означает, что для конфигурации не адресных параметров использует протокол с сохранением состояния.:

Рисунок 14. Настройка RA

Добавим конфигурации DHCP-сервера:

Рисунок 15. Добавление конфигурации DHCP-сервера

Здесь с помощью указанных выше команд создана разделяемая сеть (sharednetwork-name) с названием nvsakhno, задана информация общих опций (common-options) для разделяемой сети. При этом подсеть (subnet) 2000::/64 не требуется настраивать, поскольку она не будет содержать полезной информации.

Покажем результат с помощью команды run show configure:

Рисунок 16. Результат настройки DHCPv6 без отслеживания состояния

Перейдем к настройке сети на PC2:

Рисунок 17. Команда ifconfig нп PC2

Рисунок 18. Команда route на PC2

На узле PC2 пропингуем маршрутизатор и получим пакеты назад, следовательно соединение есть:

Рисунок 19. Пингование маршрутизатора

Проверим настройки DNS и получим адрес по DHCPv6 протоколу. Здесь опция -6 указывает на использование протокола DHCPv6, опция -S —на запрос только информации DHCPv6, но не адреса, опция -v — на вывод на экран подробной информации:

Рисунок 20. Проверка настройки DNS и получение адреса по DHCPv6

Вновь пропингуйте от узла PC2 маршрутизатор, проверьте настройки DNS:

Рисунок 21. Пингование моршрутизатора

На маршрутизаторе посмотрим выданные адреса. Почему-то сервер не показывает адрес, который он только что выдал. Хотя если пропинговать с маршрутизатора PC2 по присвоенному адресу пакеты будут получены.

Рисунок 22. Просмотр выданных адресов (представим, что на картинке они выданы)

Откроем Wireshark и посмотрим полученную информацию по захваченным пакетам. Сообщение INFORMATION-REQUEST: используется клиентом для запроса только параметров конфигурации (например адреса DNS-сервера) в случае, когда DHCPv6-сервер работает без отслеживания состояния. сообщение REPLY: используется DHCPv6-сервером для отправки клиенту сетевых настроек и завершения обработки запроса.

Передача данных в DHCPv6 осуществляется через протокол UDP, при этом сервер принимает сообщения от клиентов на порт 547 и отправляет сообщения клиентам на порт 546.

Рисунок 23. Захваченный трафик

На маршрутизаторе настроим DHCPv6 с отслеживанием состояния (DHCPv6 Stateful configuration).

На интерфейсе eth2 маршрутизатора настроим объявления о маршрутизаторах (Router Advertisements, RA). Опция managed-flag означает, что хосты использует администрируемый (отслеживающий состояние) протокол для автоматической настройки адресов в дополнение:

Рисунок 24. Настройка RA

Добавим конфигурацию DHCP-сервера на маршрутизаторе. Здесь при помощи указанных выше команд создана разделяемая сеть (shared-network-name) с названием dmbelicheva, подсеть (subnet) с адресом 2001::/64, задан диапазон адресов (range) с именем hosts, содержащий адреса 2001::100 – 2001::199:

Рисунок 26. Сохранение результатов

Покажем результат с помощью команды run show configure:

Рисунок 27. Результат настройки DHCPv6 с отслеживания состояния

Подключимся к узлу PC3 и проверим настройки сети:

Рисунок 28. Команда ifconfig в терминале PC3

На узле PC3 проверим настройки DNS и получим адрес по DHCPv6:

Рисунок 29. Проверка настройки DNS и получение адреса по DHCPv6

Вновь на узле PC3 проверим настройки сети, пропингуем маршрутизатор, проверим настройки DNS:

Рисунок 30. Команда ifconfig на терминале PC3

Рисунок 31. Команды route, ping, cat

На маршрутизаторе посмотрим выданные адреса:

Рисунок 32. Выданные адреса

Откроем Wireshark и посмотрим информацию по захваченным пакетам.

Передача данных в DHCPv6 осуществляется через протокол UDP, при этом сервер принимает сообщения от клиентов на порт 547 и отправляет сообщения клиентам на порт 546.

Процесс получения устройством адреса по протоколу DHCPv6:

– сообщение SOLICIT: устройство направляет на зарезервированный IPv6-адрес многоадресной рассылки FF02::1:2 широковещательный запрос;

– сообщение ADVERTISE: DHCPv6-сервер сообщает DHCPv6-клиенту, что сервер доступен для предоставления службы DHCPv6;

– сообщение REQUEST: используется клиентом для запроса IPv6-адреса и всех остальных параметров конфигурации от сервера в случае, когда DHCPv6-сервер работает с сохранением состояния;

– сообщение REPLY: используется DHCPv6-сервером для отправки клиенту сетевых настроек и завершения обработки запроса.

Рисунок 33. Информация по захваченным пакетам

**Выводы:**

В процессе выполнения лабораторной работы я получил навыки настройки службы DHCP на сетевом оборудовании для распределения адресов IPv4 и IPv6.